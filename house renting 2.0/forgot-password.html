<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - House Renting</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-form">
            <h2>Reset Password</h2>
            
            <!-- Step 1: Enter Email -->
            <div id="emailStep">
                <p>Enter your email address to receive an OTP.</p>
                <form id="emailForm">
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" required>
                    </div>
                    <button type="submit" class="auth-btn">Send OTP</button>
                </form>
            </div>
            
            <!-- Step 2: Verify OTP -->
            <div id="otpStep" style="display:none;">
                <p>Enter the 4-digit OTP sent to your email.</p>
                <form id="otpForm">
                    <div class="form-group">
                        <label for="otp">Enter OTP:</label>
                        <input type="text" id="otp" maxlength="4" pattern="[0-9]{4}" required>
                    </div>
                    <button type="submit" class="auth-btn">Verify OTP</button>
                </form>
            </div>
            
            <!-- Step 3: Reset Password -->
            <div id="passwordStep" style="display:none;">
                <p>Enter your new password.</p>
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="newPassword">New Password:</label>
                        <input type="password" id="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password:</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <button type="submit" class="auth-btn">Reset Password</button>
                </form>
            </div>
            
            <p><a href="login.html">Back to Login</a></p>
        </div>
    </div>

    <script>
        let resetEmail = '';
        
        document.getElementById('emailForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email);
            
            if (!user) {
                alert('Email not found in our records.');
                return;
            }
            
            resetEmail = email;
            const otp = Math.floor(1000 + Math.random() * 9000);
            localStorage.setItem('resetOTP', otp.toString());
            
            alert(`Password reset OTP: ${otp}\\n(In real app, this would be sent to your email)`);
            
            document.getElementById('emailStep').style.display = 'none';
            document.getElementById('otpStep').style.display = 'block';
        });
        
        document.getElementById('otpForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const enteredOTP = document.getElementById('otp').value;
            const storedOTP = localStorage.getItem('resetOTP');
            
            if (enteredOTP === storedOTP) {
                document.getElementById('otpStep').style.display = 'none';
                document.getElementById('passwordStep').style.display = 'block';
            } else {
                alert('Invalid OTP. Please try again.');
            }
        });
        
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.email === resetEmail);
            
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                localStorage.setItem('users', JSON.stringify(users));
                
                localStorage.removeItem('resetOTP');
                
                alert('Password reset successfully! You can now login with your new password.');
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>